# Rendering Pipeline

+ 폴리곤으로 구성된 3차원의 장면을 입력 받아 2차원 형태로 변경하고, 내부에 픽셀의 색깔을 결정한뒤 2D 모니터에 출력하는 과정.

## 1. 입력 단계

+ CPU와 GPU간의 의사소통을 하기 위해 Command Buffer(= Ring Buffer)를 이용.
+ RenderState(Vertex, Pixel Shader 등 포함)를 이용하여 GPU에 정보 전달.
+ 3차원 모델의 정점 정보를 담고있는 정점버퍼(Vertex Buffer)를 이용하여 GPU로 입력.
+ 위상 구조를 이용하여 정점 버퍼에 있는 정점을 어떤 모양으로 조립 할지 경정.
+ 점정 정보를 읽어들여 도형으로 조립.

### 1-1-1. Index Buffer

+ 정점들의 위치(Index)를 저장.
+ 중복 정점을 처리하기 위해 사용.

```
ex) 중복 정점을 처리하기 위해 사용.

사각형을 그리려면 삼각형 2개 = 정점 6개가 필요한데, 중복되는 두 정점을 IndexBuffer를 이용하여 처리
```

#### 1-1-2. 위상구조 (Primitive Topology)

+ point list, line list, triangle strip, triangle list 등이 있다.

## 2. 정점 처리 단계 (Vertex Shader)

+ 조립된 모델의 점정을 계산.

### 2-1. 월드 변환

+ 모델들을 3차원 공간안에 좌표로 이동.

### 2-2. 뷰(=카메라) 변환

+ 월드 좌표에 있는 모델들을 카메라가 보기 원하는 좌표로 이동.

#### 2-2-1. 시각 절두체 (View Frustom)

+ 가시영역 (= 보이는 영역) == View Volume
+ 컴퓨터 계산상 효율을 위해 절두체 밖부분은 그리지 않는다. (= 클리핑)

## 3. 레스터화 단계

### 3-1. 투영 변환

+ 절두체 공간을 직육면체 공간으로 변환.
+ 카메라 영역에 있는 모델들을 원근법을 이용하여 가까운 것은 크게, 먼 것은 작게 변환.

### 3-2. 클리핑

+ 투영 변환으로 생긴 직육면체 공간 밖 부분들을 잘라낸다.

### 3-3. 뒷면 제거 (Back-face Culling)

+ 앞면(Front-face), 뒷면(Back-face)이라 부른다.
+ 카메라에 보이지 않는 뒷면(Back-face)를 제거하는 과정.

### 3-4. 뷰 포트 변환 (View-Port Transform)

+ 컴퓨터 화면상의 윈도우를 스크린 공간(Screen Space)이라 부른다.
+ 2차원 좌표(NDC)에 있는 모델들을 2차원 스크린 공간(View-Port)으로 변환하는 과정.

#### 3-4-1. 정규 좌표 (NDC = normalized device coordinates)

+ (x,y,z,w)의 3차원 좌표를 (x,y,z)의 2차원 좌표로 변환한 좌표.

### 3-5. 스캔 변환 (Scan Transform)

+ 삼각형이 차지하는 스크린 공간의 픽셀 위치를 결정.
+ 삼각형의 정점별 속성을 보간(interpolation)하여 이를 각 픽셀 위치에 할당하는 일을 수행.

## 4. 픽셀/플래그먼트 처리 단계 (Fixel/Fragment Shader)

#### 4-1. 시저 테스트

+ 프레임 버퍼(= Color Buffer)에 지정한 영역만 화면에 출력.

#### 4-2. 스텐실 테스트 (Stencil TEST)

+ 스텐실 버퍼에 지정한 역역을 화면에 출력하지 않도록 한다.

#### 4-3. 알파 테스트

+ 출력하려는 픽셀 색이 투명하다면 출력하지 않도록 한다.

#### 4-4. 깊이 테스트 (Z-TEST)

+ 물체의 깊이를 테스트.
+ 그리려는 물체의 깊이가 더 작은 것을 Z-Buffer에 기록.

## 5. 출력